function login (email, password, db_function) {
    var dbox = require('dbox'),
        phantom = require('phantom');

    var APP_KEY = '7a870efg25be689',
        APP_SECRET = '0ly99wm2hgau5qq';

    var app = dbox.app({
        'app_key': APP_KEY,
        'app_secret': APP_SECRET
    });
    var reqTok;
    app.requesttoken(function(status, request_token){
        console.log(request_token.authorize_url);
        reqTok = request_token;
    });

    var interval = setInterval(function(){
        if (reqTok != null) {
            clearInterval(interval);
            tokenMachine();
        }
    }, 1000);

    function tokenMachine() {
        console.log(reqTok.authorize_url);
        phantom.create(function (ph) {
            ph.createPage(function (page) {
                page.open(reqTok.authorize_url, function (status) {
                    page.includeJs('http://code.jquery.com/jquery-1.10.1.min.js', function () {

                       page.evaluate((function (email, password, reqTok, db_function) {
                            document.getElementById('login_email').value = email;
                            document.getElementById('login_password').value = password;
                            document.getElementById('login_submit').click();
                            return reqTok;
                        }), function (result) {
                            setTimeout(function() {
                                console.log('asdf');
                                page.evaluate((function (email, password, reqTok, db_function) {
                                    document.getElementsByName('allow_access')[0].click();
                                    return document.title
                                }), function(result) {
                                    setTimeout(function() {
                                        page.render('image.png');
                                        app.accesstoken(reqTok, function(status, access_token){
                                            db_function(access_token);
                                        });  
                                        ph.exit();
                                    }, 5000);
                                }, email, password, reqTok, db_function);
                            }, 5000);
                        }, email, password, reqTok, db_function);
                    });
                    page.render('example.png');
                });
            });
        });
    }
    
}
module.exports = login;