function generateDropboxAccount(db_function) {
    var phantom = require('phantom'),
        EMAIL,
        maildropAddress = "http://maildrop.cc";

    phantom.create(function(ph) {
        return ph.createPage(function(maildropPage) {
            return maildropPage.open(maildropAddress, function(status) {
                if (status == 'success') {
                    return maildropPage.includeJs("http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js", function() {
                        return maildropPage.evaluate((function(EMAIL) {
                            return $('#suggestion a').html();
                        }), function(result) {
                            // console.log(result);
                            EMAIL = result;
                            ph.exit();
                            return result;
                        }, EMAIL);
                    });
                }
            });
        });
    });
    var interval = setInterval(function(){
        if (EMAIL != null) {
            console.log("dropbox");
            console.log(EMAIL);
            clearInterval(interval);
            var PASSWORD = 'dummy_password'
            dropbox(EMAIL, PASSWORD, db_function);
        }
    }, 1000);

    function dropbox(EMAIL, PASSWORD, db_function) {
        var phantom = require('phantom'),
            dropboxAddress = "http://dropbox.com";
        phantom.create(function(ph) {
            ph.createPage(function(dropboxPage) {
                dropboxPage.open(dropboxAddress, function(dstatus) {
                    if (dstatus == 'success') {
                        dropboxPage.evaluate(function(EMAIL, PASSWORD, db_function) {
                            document.getElementById("fname").value = "dummy_fname";
                            document.getElementById("lname").value = "dummy_lname";
                            document.getElementById("email").value = EMAIL;
                            document.getElementById("password").value = PASSWORD;
                            document.getElementById("tos_agree").checked = true;
                            //document.getElementById("signup-form").submit();
                            return EMAIL;
                        }, function(response) {
                            EMAIL = response;
                            db_function(EMAIL);
                            console.log("done");
                            ph.exit();
                        }, EMAIL, PASSWORD, db_function);
                    }
                });
            });
        });
    }

}

module.exports = generateDropboxAccount;